<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>InfoViso</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="/css/bootstrap.min.css" rel="stylesheet" media="screen">
        <link href="/css/bootstrap-responsive.min.css" rel="stylesheet">

		<script src="/socket.io/socket.io.js"></script>
        <script src="/libraries/jquery-1.9.1.min.js"></script>
        <script src="/libraries/bootstrap.min.js"></script>
        <script src="/libraries/processing-1.4.1.min.js"></script>
        <script src="/libraries/moment.min.js"></script>

		<script type="text/javascript">
            var zeitResponse;

            $(document).ready(function(){

                var sketch          = new Processing.Sketch();
                var sketchWidth     = $(window).width();
                var sketchHeigth    = 440;
                var socket          = io.connect();  //globales io Object, des Servers, aufrufen

                // Daten senden
                socket.emit('zeit', { content: 'liebe' });

                // Daten empfangen
                socket.on('zeitResponse', function(data){
                    zeitResponse     = new Array();
                    var i 			= 0;

                    // API Request Verarbeiten: Jahreszahl und Anzahl der vorgekommenen Wörter pro Jahr in einem Array konvertieren
                    // und Gesammtanzahl der gefunden Wörter
                    $.each(data.facets.release_date, function(index, value){
                        if(index !== 'start' && index !== 'end' && index !== 'gap') {
                            zeitResponse.push([Number(moment(index).format('YYYY')), value]);
                            i++;
                        }
                    });
                    // Sortieren nach Jahr
                    zeitResponse.sort(function(a,b) {return a[0] - b[0];} );
                    // Anzhal der gefundenen Wörter
                    zeitResponse['found'] = data.found;
              });


                sketch.attachFunction = function(processing){

                    processing.setup = function(){
                        processing.noStroke();
                        processing.smooth();
                        processing.background(241, 241, 241);
                    };

                    processing.draw = function(){
                        processing.size(sketchWidth,sketchHeigth);

                        if(typeof zeitResponse != 'undefined'){
                            /*for(var i=0; i < zeitResponse.length; i++){
                                //todo
                            }; */
                            drawYear(processing,40,0,100,50,1754);
                        };

                    };

                };

                var canvas = document.getElementById("myCanvas");
                // attaching the sketch to the canvas
                var p = new Processing(canvas, sketch);


            });

            function drawYear(processing, startPointX, startPointY, value1, value2, year){
                processing.pushMatrix();
                //Anfangsposition festlegen
                processing.translate(startPointX,startPointY);
                processing.pushMatrix();
                processing.strokeWeight(2);
                processing.stroke(140,134,129,20);
                processing.line(startPointX,startPointY,startPointX,processing.height);
                //Value 1
                processing.translate(startPointX,processing.height*0.33);
                processing.fill(33,51,49,190);
                processing.ellipseMode(processing.CENTER)
                processing.ellipse(0,0,value1,value1);
                processing.popMatrix();
                // Value 2
                processing.pushMatrix();
                processing.translate(startPointX,processing.height*0.66);
                processing.fill(224,209,163,190);
                processing.ellipseMode(processing.CENTER)
                processing.ellipse(0,0,value2,value2);
                processing.popMatrix();
                // Year
                processing.pushMatrix();
                //processing.translate(startPointX,distanz*5);
                processing.fill(0);
                processing.text(year,startPointX-15,processing.height-5);
                processing.popMatrix();
                processing.popMatrix();
            };

		</script>
	</head>
	<body>
        <div class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <span class="brand" style="padding-left: 40px;">Informationsvisualisierung</span>
                <ul class="nav">
                    <li class="active"><a href="#">App</a></li>
                    <li><a href="#">Theorie</a></li>
                    <li><a href="#">Code</a></li>
                </ul>
                <span class="text-right help-block" style="padding-right: 20px; padding-top: 10px;">
                    <smal>philipp.krehl@fh-stralsund.de</smal>
                </span>
            </div>
        </div>
        <div class="container-fluid" style="margin-top: 45px; padding: 0;">
            <div class="row-fluid">
                <div class="page-header" style="margin-bottom: 10px; margin-top: 5px;  padding-bottom: 5px;">
                    <h2 style="margin-left: 10px">Querys <small> - Fragen von Interesse - </small> </h2>
                </div>
            </div>
            <div class="row-fluid" style="height: 70px;">
                <form>
                    <fieldset>
                        <div class="span3" style="margin-left: 20px;">
                            <label>Was sagt Zeit Online über:</label>
                            <input type="text" placeholder="Iraq">
                        </div>
                        <div class="span3">
                            <label>Was sagt New York Times über:</label>
                            <input type="text" placeholder="Iraq">
                        </div>
                    </fieldset>
                </form>
            </div>
            <div class="row-fluid">
                <div class="span12">
                    <canvas id="myCanvas"></canvas>
                </div>
            </div>
        </div>
	</body>
</html>