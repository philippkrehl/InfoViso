<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>InfoViso</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="/css/bootstrap.min.css" rel="stylesheet" media="screen">
        <link href="/css/bootstrap-responsive.min.css" rel="stylesheet">

		<script src="/socket.io/socket.io.js"></script>
        <script src="/libraries/jquery-1.9.1.min.js"></script>
        <script src="/libraries/bootstrap.min.js"></script>
        <script src="/libraries/processing-1.4.1.min.js"></script>
        <script src="/libraries/moment.min.js"></script>
        <script src="/libraries/jquery.overscroll.min.js"></script>

		<script type="text/javascript">

            $(document).ready(function(){

                var sketch          = new Processing.Sketch();
                var sketchWidth     = $(window).width();
                var sketchHeigth    = 440;
                var socket          = io.connect();  //globales io Object, des Servers, aufrufen
                var yearBegin       = 1993;
                var yearEnd         = 2012;
                var processingArray = new Array(yearEnd-yearBegin+1);
                var scale           = 1.00;

                for(var x = 0; x < processingArray.length; x++){
                    processingArray[x] = {
                        'year': yearBegin,
                        'zeit': 0,
                        'nyt' : 0
                    };
                    yearBegin++;
                }

                // Daten senden für Zeit online
                socket.emit('zeit', { content: 'facebook' });

                // Daten empfangen von Zeit online
                socket.on('zeitResponse', function(data){
                    for(var i = 0; i < processingArray; i++){
                        processingArray[i].zeit = 0;
                    }
                    // API Request Verarbeiten: Jahreszahl und Anzahl der vorgekommenen Wörter pro Jahr in einem Array konvertieren
                    // und Gesammtanzahl der gefunden Wörter
                    $.each(data.facets.release_date, function(date, value){
                        for(var x = 0; x < processingArray.length; x++){
                            if(date !== 'start' && date !== 'end' && date !== 'gap') {
                                if(Number(moment(date).format('YYYY')) == processingArray[x].year){
                                    processingArray[x].zeit = value;
                                    break;
                                };
                            };
                        };
                    });
                });

                // Daten senden für New York Times
                socket.emit('nyt', { content: 'facebook' });

                socket.on('nytResponse', function(data){
                    for(var i = 0; i < processingArray; i++){
                        processingArray[i].nyt = 0;
                    }
                    // API Request Verarbeiten: Jahreszahl und Anzahl der vorgekommenen Wörter pro Jahr in einem Array konvertieren
                    // und Gesammtanzahl der gefunden Wörter
                    for(var i = 0; i  < data.facets.publication_year.length; i++ ){
                        for(var x = 0; x < processingArray.length; x++){
                            if(parseInt(data.facets.publication_year[i].term) == processingArray[x].year){
                                processingArray[x].nyt = data.facets.publication_year[i].count;
                                break;
                            };
                        };
                    };
                });

                sketch.attachFunction = function(processing){

                    processing.setup = function(){
                        processing.noStroke();
                        processing.smooth();
                        processing.background(241, 241, 241);
                    };

                    processing.draw = function(){
                        processing.size(sketchWidth,sketchHeigth);
                        processing.scale(scale);
                        processing.background(241, 241, 241);
                        var distanceX = 40;
                        for(var i = 0; i < processingArray.length; i++){
                            drawYear(processing,distanceX,0,processingArray[i].zeit*0.2,processingArray[i].nyt*0.2,processingArray[i].year);
                            distanceX += 40;
                        };
                     };
                };

                var canvas = document.getElementById("myCanvas");
                // attaching the sketch to the canvas
                var p = new Processing(canvas, sketch);

                $('#zeitButton').click(function(){
                    // Daten senden
                    if($('#zeitInput').val() == ''){
                        socket.emit('zeit', { content: 'Irak' });
                    }
                    else{
                        socket.emit('zeit', { content: $('#zeitInput').val() });
                    };
                });

                $('#nytButton').click(function(){
                    // Daten senden
                    if($('#nytInput').val() == ''){
                        socket.emit('nyt', { content: 'Iraq' });
                    }
                    else{
                        socket.emit('nyt', { content: $('#nytInput').val() });
                    };
                });

                $('#scale').change(function(){
                    scale = this.value;
                });
            });

            function drawYear(processing, startPointX, startPointY, value1, value2, year){
                processing.pushMatrix();
                //Anfangsposition festlegen
                processing.translate(startPointX,startPointY);
                processing.pushMatrix();
                processing.strokeWeight(2);
                processing.stroke(140,134,129,20);
                processing.line(startPointX,startPointY,startPointX,processing.height);
                //Value 1
                processing.translate(startPointX,processing.height*0.33);
                processing.fill(33,51,49,190);
                processing.ellipseMode(processing.CENTER)
                processing.ellipse(0,0,value1,value1);
                processing.popMatrix();
                // Value 2
                processing.pushMatrix();
                processing.translate(startPointX,processing.height*0.66);
                processing.fill(224,209,163,190);
                processing.ellipseMode(processing.CENTER)
                processing.ellipse(0,0,value2,value2);
                processing.popMatrix();
                // Year
                processing.pushMatrix();
                //processing.translate(startPointX,distanz*5);
                processing.fill(0);
                processing.text(year,startPointX-15,processing.height-5);
                processing.popMatrix();
                processing.popMatrix();
            };
    </script>
	</head>
	<body>
        <div class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <span class="brand" style="padding-left: 40px;">Informationsvisualisierung</span>
                <ul class="nav">
                    <li class="active"><a href="#">App</a></li>
                    <li><a href="#">Theorie</a></li>
                    <li><a href="#">Code</a></li>
                </ul>
                <span class="text-right help-block" style="padding-right: 20px; padding-top: 10px;">
                    <smal>philipp.krehl@fh-stralsund.de</smal>
                </span>
            </div>
        </div>
        <div class="container-fluid" style="margin-top: 45px; padding: 0;">
            <div class="row-fluid">
                <div class="page-header" style="margin-bottom: 10px; margin-top: 5px;  padding-bottom: 5px;">
                    <h2 style="margin-left: 10px">Querys <small> - Fragen von Interesse - </small> </h2>
                </div>
            </div>
            <div class="row-fluid" style="height: 70px;">
                <form>
                    <fieldset>
                        <div class="span3 input-append" style="margin-left: 20px;">
                            <label>Was sagt Zeit Online über:</label>
                            <input id="zeitInput" type="text" placeholder="Irak">
                            <button id="zeitButton" class="btn" type="button">Go!</button>

                        </div>
                        <div class="span3 input-append">
                            <label>Was sagt New York Times über:</label>
                            <input id="nytInput" type="text" placeholder="Iraq">
                            <button id="nytButton" class="btn" type="button">Go!</button>
                        </div>
                        <div class="span3">
                            <label>Scalierung:</label>
                            <input id="scale" type="range" min="0.01" max="4.00" step="0.01" value='1.00'>
                        </div>
                    </fieldset>
                </form>
            </div>
            <div class="row-fluid">
                <div id="canvasContainer">
                    <canvas id="myCanvas"></canvas>
                </div>
            </div>
        </div>
	</body>
</html>