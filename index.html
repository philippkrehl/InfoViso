<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>InfoV</title>
	<script src="libraries/jquery-1.9.1.min.js"></script>
	<script src="libraries/processing-1.4.1.min.js"></script>
	<script src="libraries/moment.min.js"></script>
	
	<script type="text/javascript">
	
	//Globale Variablen
	
	// Zugriff auf die erste Jahreszahl: loveArray[1],
	// Zugriff auf Gesammtzahl: loveArray['found']);
	// Zugriff auf den Wert der ersten Jahreszahl: loveArray[0][0]
	var loveArray = new Array();
	var hateArray = new Array();
	
	$( document ).ready(function() {
		
		var urlLove = createRequestURL('content',
								   '6e499da47fcb281145e490fb6fba3d02028ba8c83af1f50383ee',
								   null,
								   null,
								   'liebe',
								   null,
								   '1year',
								   null,
								   null);
		
	    $.ajax({
	       type: 'GET',
	        url: urlLove,
	        contentType: "application/json",
	        dataType: 'jsonp',
	        success: function(data) { loveArray = successCallback(data); },
	        error: function() { notSuccessCallback(); },
	        complete : function() {console.log(loveArray[1]); }
	    });
	});
	
    function successCallback(data){
    	var arrayObject = new Array();
    	var i = 0;
    	// API Request verarbeiten: Jahreszahl und Anzahl der vorgekommenen Wörter pro Jahr in einem Array konvertieren 
    	// und Gesammtanzahl der gefunden Wörter
    	$.each(data.facets.release_date, function(index, value){
    		if(index !== 'start' && index !== 'end' && index !== 'gap') {
    			arrayObject.push([Number(moment(index).format('YYYY')), value]);
    			i++;
    		}
    	})
    	// Sortieren nach Jahr
    	arrayObject.sort(function(a,b) {return a[0] - b[0]});
    	// Anzhal der gefundenen Wörter
    	arrayObject['found'] = data.found;
    	return arrayObject;
    }
    
    function notSuccessCallback(){
    	console.log('fail');
    }
    
    function createRequestURL(topic, key, sort, fields, query, limit, facet_date, offset, facet_field){
    	var url = 'http://api.zeit.de/';
    	
    	//content || keyword
    	if(typeof topic === 'string'){
    		url = url + topic;
    	};
    	
    	//API Key
    	if(typeof key === 'string'){
    		url = url + '?api_key=' + key;
    	};
    	
    	//release_date desc
    	if(typeof sort === 'string'){
    		url = url + '?sort=' + sort;
    	}; 
    	
       	// subtitle,uuid,title,href,release_date,uri,snippet,supertitle,teaser_title,teaser_text
    	if(typeof fields === 'string'){
    		url = url + '&fields=' + fields;
    	};
    	
       	// s. Domkumentation
    	if(typeof query === 'string'){
    		url = url + '&q=' + query;
    	};      	
    	
       	// limit the amount of matches to return
    	if(typeof limit === 'int'){
    		url = url + '&limit=' + limit;
    	};        	

       	// The facet_date parameter returns counts for the distribution over a specified date range
       	// facet_date	1day, 7day, 1month, 1year, 10year or any numerical variation
    	if(typeof facet_date === 'string'){
    		url = url + '&facet_date=' + facet_date;
    	}; 
       	
       	// offset for the list of matches
    	if(typeof offset === 'int'){
    		url = url + '&offset=' + offset;
    	}; 
       
       	// The facet_field parameter is used to get a frequency distribution for the different values of a field
       	// facet_field	keyword, author, series, department, product or any combination
    	if(typeof facet_field === 'string'){
    		url = url + '&facet_field=' + facet_field;
    	};
    		   	
       	return encodeURI(url)
    }
		
	</script>
</head>
<body>

<div id="container">
	
</div>

</body>
</html>